<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>San Francisco Repülőtér – Diagramok</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

  <h2 style="text-align:center;">1. San Francisco repülőtér forgalma évenként</h2>
  <div id="chart1" style="width:90%;max-width:1000px;height:500px;margin:auto;"></div>

  <h2 style="text-align:center;">2. Belföldi és nemzetközi utasok aránya</h2>
  <div id="chart2" style="width:90%;max-width:800px;height:500px;margin:auto;"></div>

  <h2 style="text-align:center;">3. Legforgalmasabb hónapok évenként</h2>
  <div id="chart3" style="width:90%;max-width:1000px;height:500px;margin:auto;"></div>

  <h2 style="text-align:center;">4. Top 20 légitársaság kumulált utasszám alapján</h2>
  <div id="chart4" style="width:90%;max-width:1000px;height:500px;margin:auto;"></div>

  <h2 style="text-align:center;">5. San Francisco-ból induló járatok célállomásai (térkép)</h2>
  <div id="map" style="width:100%;height:90vh;"></div>

  <script>
    // Diagram 1: Éves utasszám
    fetch("https://mlaszar.github.io/San_Francisco.json")
      .then(res => res.json())
      .then(data => {
        const yearlyTotals = {};
        data.forEach(d => {
          const parts = d["Activity Period Start Date"].split('/');
          let year = +parts[2];
          year += (year < 50 ? 2000 : 1900);
          const passengers = parseInt(d["Passenger Count"].replace(/,/g, ""));
          if (!yearlyTotals[year]) yearlyTotals[year] = 0;
          yearlyTotals[year] += passengers;
        });
        const years = Object.keys(yearlyTotals).sort();
        const counts = years.map(y => yearlyTotals[y]);

        Plotly.newPlot("chart1", [{
          x: years,
          y: counts,
          type: 'scatter',
          mode: 'lines+markers',
          marker: { color: 'blue' }
        }], {
          title: 'San Francisco éves utasszám',
          xaxis: { title: 'Év' },
          yaxis: { title: 'Utasszám' }
        });
      });

    // Diagram 2: Pie chart – Domestic vs International
    fetch("https://mlaszar.github.io/San_Francisco.json")
      .then(res => res.json())
      .then(data => {
        const totals = { Domestic: 0, International: 0 };
        data.forEach(d => {
          const type = d["GEO Summary"];
          const count = parseInt(d["Passenger Count"].replace(/,/g, ""));
          if (type === "Domestic") totals.Domestic += count;
          if (type === "International") totals.International += count;
        });

        Plotly.newPlot("chart2", [{
          values: [totals.Domestic, totals.International],
          labels: ["Belföldi", "Nemzetközi"],
          type: 'pie',
          textinfo: 'label+percent',
          hole: 0.4
        }], {
          title: 'Belföldi és nemzetközi utasok aránya'
        });
      });

    // Diagram 3: Legforgalmasabb hónapok évente
    fetch("https://mlaszar.github.io/San_Francisco.json")
      .then(res => res.json())
      .then(data => {
        data.forEach(d => {
          const parts = d["Activity Period Start Date"].split('/');
          let year = +parts[2];
          year += (year < 50 ? 2000 : 1900);
          d.year = year;
          d.month = parseInt(parts[0], 10);
          d.passengers = parseInt(d["Passenger Count"].replace(/,/g, ""), 10);
        });

        data = data.filter(d => d.year !== 2025);
        const monthlyTotals = {};
        data.forEach(d => {
          const key = `${d.year}-${d.month}`;
          monthlyTotals[key] = (monthlyTotals[key] || 0) + d.passengers;
        });

        const maxMonths = {};
        for (const key in monthlyTotals) {
          const [year, month] = key.split('-').map(Number);
          if (!maxMonths[year] || monthlyTotals[key] > maxMonths[year].passengers) {
            maxMonths[year] = { month, passengers: monthlyTotals[key] };
          }
        }

        const years = Object.keys(maxMonths).sort();
        const yData = years.map(y => maxMonths[y].passengers);
        const textData = years.map(y => [
          "Január", "Február", "Március", "Április", "Május", "Június",
          "Július", "Augusztus", "Szeptember", "Október", "November", "December"
        ][maxMonths[y].month - 1]);

        Plotly.newPlot("chart3", [{
          x: years,
          y: yData,
          text: textData,
          type: 'bar',
          marker: { color: 'skyblue' },
          hovertemplate: "Év: %{x}<br>Utasszám: %{y}<br>Hónap: %{text}<extra></extra>"
        }], {
          title: "Legforgalmasabb hónapok évente",
          xaxis: { title: "Év" },
          yaxis: { title: "Utasszám" }
        });
      });

    // Diagram 4: Top 20 légitársaság
    fetch("https://mlaszar.github.io/San_Francisco.json")
      .then(res => res.json())
      .then(data => {
        const airlineTotals = {};
        data.forEach(entry => {
          const airline = entry["Operating Airline"];
          const count = parseInt(entry["Passenger Count"].replace(/,/g, ''));
          if (!airline || isNaN(count)) return;
          airlineTotals[airline] = (airlineTotals[airline] || 0) + count;
        });

        const sorted = Object.entries(airlineTotals).sort((a, b) => b[1] - a[1]).slice(0, 20);
        Plotly.newPlot("chart4", [{
          x: sorted.map(i => i[0]),
          y: sorted.map(i => i[1]),
          type: 'bar',
          marker: { color: 'orange' }
        }], {
          title: 'Top 20 Légitársaság',
          xaxis: { tickangle: -45 },
          yaxis: { title: 'Utasszám' }
        });
      });

    // Diagram 5: Térképes célállomások
    fetch("https://mlaszar.github.io/San_Francisco.json")
      .then(res => res.json())
      .then(data => {
        const mapData = {};
        data.forEach(row => {
          const key = `${row.Destination}_${row.Latitude}_${row.Longitude}`;
          const count = parseFloat(row["Passenger Count"]) || 0;
          if (!mapData[key]) {
            mapData[key] = {
              destination: row.Destination,
              lat: +row.Latitude,
              lon: +row.Longitude,
              count: count
            };
          } else {
            mapData[key].count += count;
          }
        });

        const points = Object.values(mapData);
        Plotly.newPlot("map", [{
          type: 'scattergeo',
          mode: 'markers',
          text: points.map(p => `${p.destination}<br>Utasok száma: ${Math.round(p.count)}`),
          lat: points.map(p => p.lat),
          lon: points.map(p => p.lon),
          marker: {
            size: points.map(p => Math.sqrt(p.count) * 2),
            color: points.map(p => p.count),
            colorscale: 'Viridis',
            colorbar: { title: 'Utasok száma' },
            line: { color: 'white', width: 0.5 }
          }
        }], {
          title: 'San Francisco járatok térképe',
          geo: { showland: true, projection: { type: "natural earth" } }
        });
      });
  </script>

</body>
</html>
