<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>San Francisco Repülőtér Utasforgalom</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>

    <h1 style="text-align:center;">San Francisco repülőtér – Utasforgalmi áttekintés</h1>

    <!-- 1. Pre-COVID vs Post-COVID -->
    <section>
        <h2 style="text-align:center;">Passenger Count Comparison: Pre-COVID vs Post-COVID</h2>
        <div id="passenger_plot" style="width:90%;max-width:1000px;height:600px;margin:auto;"></div>
        <script>
            var trace1 = {
                x: [2015, 2016, 2017, 2018, 2019],
                y: [4500000, 4700000, 4800000, 5000000, 5200000],
                mode: 'lines+markers',
                name: 'Pre-COVID',
                line: { color: 'blue' }
            };
            var trace2 = {
                x: [2020, 2021, 2022],
                y: [1800000, 2300000, 3100000],
                mode: 'lines+markers',
                name: 'Post-COVID',
                line: { color: 'red' }
            };
            var layout = {
                title: 'Passenger Count Comparison: Pre-COVID vs Post-COVID',
                xaxis: { title: 'Year' },
                yaxis: { title: 'Passenger Count' },
                hovermode: 'x unified'
            };
            Plotly.newPlot('passenger_plot', [trace1, trace2], layout);
        </script>
    </section>

    <!-- 2. Havi utasforgalom (US célállomások) -->
    <!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <title>Havi utasforgalom – Évek szerint</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h2 style="text-align:center;">Havi utasforgalom – Évek szerint</h2>
    <div id="chart" style="width:90%; max-width:1000px; margin:auto;"></div>

    <script>
        const jsonUrl = 'https://raw.githubusercontent.com/mlaszar/mlaszar.github.io/main/San_Francisco.json';

        const monthOrder = ['January', 'February', 'March', 'April', 'May', 'June',
                            'July', 'August', 'September', 'October', 'November', 'December'];

        const colorMap = {
            "January": "#1f77b4",
            "February": "#17becf",
            "March": "#2ca02c",
            "April": "#bcbd22",
            "May": "#ffbb78",
            "June": "#ff7f0e",
            "July": "#d62728",
            "August": "#e377c2",
            "September": "#9467bd",
            "October": "#8c564b",
            "November": "#7f7f7f",
            "December": "#1f77b4"
        };

        fetch(jsonUrl)
            .then(response => response.json())
            .then(data => {
                const monthlyData = {};

                data.forEach(item => {
                    const dest = item["Destination"];
                    const dateStr = item["Activity Period Start Date"];
                    const countStr = item["Passenger Count"];

                    if (dest !== "US" || !dateStr || !countStr) return;

                    const [month, day, yearShort] = dateStr.split('/');
                    const year = +('20' + yearShort.padStart(2, '0'));
                    if (year >= 2025) return;

                    const monthIndex = parseInt(month, 10) - 1;
                    const monthName = monthOrder[monthIndex];

                    const count = parseInt(countStr.replace(/,/g, ''));
                    if (isNaN(count)) return;

                    const key = `${year}_${monthName}`;
                    monthlyData[key] = (monthlyData[key] || 0) + count;
                });

                const yearSet = new Set();
                const traces = [];

                monthOrder.forEach((month, i) => {
                    const x = [];
                    const y = [];

                    for (const key in monthlyData) {
                        if (key.endsWith('_' + month)) {
                            const year = key.split('_')[0];
                            x.push(+year);
                            y.push(monthlyData[key]);
                            yearSet.add(+year);
                        }
                    }

                    traces.push({
                        x: x,
                        y: y,
                        mode: 'lines+markers',
                        name: month,
                        line: {
                            width: 1.5,
                            color: colorMap[month] || 'gray'
                        },
                        visible: true
                    });
                });

                // Dropdown gombok
                const buttons = monthOrder.map((month, i) => ({
                    label: month,
                    method: 'update',
                    args: [
                        { visible: monthOrder.map((_, j) => j === i) },
                        { title: `${month} – éves utasforgalom` }
                    ]
                }));

                buttons.unshift({
                    label: 'Összes hónap',
                    method: 'update',
                    args: [
                        { visible: monthOrder.map(() => true) },
                        { title: 'Havi utasforgalom – Évek szerint' }
                    ]
                });

                const layout = {
                    title: 'Havi utasforgalom – Évek szerint',
                    xaxis: { title: 'Év' },
                    yaxis: { title: 'Utasok száma' },
                    updatemenus: [{
                        buttons: buttons,
                        direction: 'down',
                        showactive: true,
                        x: 1.1,
                        y: 1.2,
                        xanchor: 'right',
                        yanchor: 'top'
                    }],
                    height: 600,
                    plot_bgcolor: '#fff'
                };

                Plotly.newPlot('chart', traces, layout);
            })
            .catch(error => {
                console.error('Hiba történt a JSON beolvasásakor:', error);
            });
    </script>
</body>
</html>

    <!-- 3. Legforgalmasabb hónap évenként -->
    <section>
        <h2 style="text-align:center;">Legforgalmasabb hónapok évenként (San Francisco)</h2>
        <div id="chart_top_months" style="width:90%;max-width:1000px;height:600px;margin:auto;"></div>
        <script>
            const url = "https://raw.githubusercontent.com/mlaszar/mlaszar.github.io/main/San_Francisco.json";
            const monthNames = ["Január", "Február", "Március", "Április", "Május", "Június", "Július", "Augusztus", "Szeptember", "Október", "November", "December"];
            const colorMap = {
              1: 'rgb(100,100,255)', 2: 'rgb(100,100,255)', 3: 'rgb(0,255,255)',
              4: 'rgb(0,255,255)', 5: 'rgb(0,255,0)', 6: 'rgb(255,255,0)',
              7: 'rgb(255,165,0)', 8: 'rgb(255,0,0)', 9: 'rgb(255,255,0)',
              10: 'rgb(255,255,0)', 11: 'rgb(255,165,0)', 12: 'rgb(0,0,255)'
            };

            fetch(url)
              .then(res => res.json())
              .then(data => {
                data.forEach(d => {
                  const parts = d["Activity Period Start Date"].split('/');
                  d.year = 2000 + parseInt(parts[2], 10);
                  if (d.year > new Date().getFullYear()) d.year -= 100;
                  d.month = parseInt(parts[0], 10);
                  d.passengers = parseInt(d["Passenger Count"].replace(/,/g, ''), 10);
                });
                data = data.filter(d => d.year !== 2025);

                const totals = {};
                data.forEach(d => {
                  const key = `${d.year}-${d.month}`;
                  if (!totals[key]) totals[key] = 0;
                  totals[key] += d.passengers;
                });

                const maxPerYear = {};
                for (const key in totals) {
                  const [year, month] = key.split('-').map(Number);
                  if (!maxPerYear[year] || totals[key] > maxPerYear[year].passengers) {
                    maxPerYear[year] = { month, passengers: totals[key] };
                  }
                }

                const years = Object.keys(maxPerYear).sort((a, b) => a - b);
                const passengerCounts = years.map(y => maxPerYear[y].passengers);
                const labels = years.map(y => monthNames[maxPerYear[y].month - 1]);
                const colors = years.map(y => colorMap[maxPerYear[y].month]);

                const trace = {
                  x: years.map(String),
                  y: passengerCounts,
                  text: labels,
                  type: 'bar',
                  marker: { color: colors },
                  hovertemplate: "Év: %{x}<br>Utasszám: %{y}<br>Hónap: %{text}<extra></extra>"
                };

                const layout = {
                  title: 'Legforgalmasabb hónap évenként (induló járatok)',
                  xaxis: { title: 'Év' },
                  yaxis: { title: 'Utasszám' }
                };

                Plotly.newPlot('chart_top_months', [trace], layout);
              })
              .catch(err => {
                document.getElementById('chart_top_months').innerText = 'Hiba a JSON betöltésekor!';
              });
        </script>
    </section>

    <!-- 4. Top 20 Légitársaság -->
    <section>
        <h2 style="text-align:center;">Top 20 légitársaság kumulált utasszám alapján</h2>
        <div id="chart_top_airlines" style="width:90%; max-width:1000px; margin:auto;"></div>
        <script>
            const jsonUrl = 'https://raw.githubusercontent.com/mlaszar/mlaszar.github.io/main/San_Francisco.json';
            fetch(jsonUrl)
              .then(response => response.json())
              .then(data => {
                const airlineTotals = {};
                data.forEach(entry => {
                  const airline = entry['Operating Airline'];
                  let passengers = entry['Passenger Count'];
                  if (!airline || !passengers) return;
                  passengers = parseInt(passengers.replace(/,/g, ''));
                  if (isNaN(passengers)) return;
                  if (!airlineTotals[airline]) airlineTotals[airline] = 0;
                  airlineTotals[airline] += passengers;
                });

                const sortedAirlines = Object.entries(airlineTotals)
                  .sort((a, b) => b[1] - a[1])
                  .slice(0, 20);

                const airlines = sortedAirlines.map(item => item[0]);
                const passengers = sortedAirlines.map(item => item[1]);

                const trace = {
                  x: airlines,
                  y: passengers,
                  type: 'bar',
                  marker: {
                    color: passengers,
                    colorscale: 'Plasma'
                  }
                };

                const layout = {
                  title: 'Top 20 légitársaság kumulált utasszám alapján',
                  xaxis: { title: 'Légitársaság', tickangle: -45 },
                  yaxis: { title: 'Utasok száma' },
                  plot_bgcolor: '#fff'
                };

                Plotly.newPlot('chart_top_airlines', [trace], layout);
              })
              .catch(error => console.error('Hiba történt a JSON beolvasásakor:', error));
        </script>
    </section>

</body>
</html>
